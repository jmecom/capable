package safe
module slice_safe_read
use sys.system
use sys.console
use sys.buffer

pub fn main(sys: System) -> i32 {
  let c = system.console(sys)
  let alloc = buffer.alloc_default()
  match buffer.buffer_new(alloc, 1) {
    Ok(b) => {
      let slice = buffer.buffer_as_slice(b)
      let v = buffer.slice_at(slice, 0)
      if (v == buffer.slice_at(slice, 0)) {
        console.println(c, "slice read ok")
      } else {
        console.println(c, "slice read bad")
      }
      buffer.buffer_free(alloc, b)
      return 0
    }
    Err(e) => {
      console.println(c, "buffer err")
      return 1
    }
  }
}
