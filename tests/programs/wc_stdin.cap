package safe
module wc_stdin
use sys::system

pub fn main(rc: RootCap) -> i32 {
  let c = rc.mint_console()
  let stdin = rc.mint_stdin()
  let alloc = rc.mint_alloc_default()
  let code = match stdin.read_to_string(alloc) {
    Ok(s) => {
      let buf = s.bytes()
      let bytes = buf.len()
      let words_vec = s.split_whitespace(alloc)
      let words = words_vec.len()
      alloc.vec_string_free(words_vec)
      let i: i32 = 0
      let lines: i32 = 0
      while (i < bytes) {
        let b = buf.at(i)
        if (b == '\n') {
          lines = lines + 1
        }
        i = i + 1
      }
      c.assert(lines == 0 && words == 0 && bytes == 0)
      c.print_i32(lines)
      c.print(" ")
      c.print_i32(words)
      c.print(" ")
      c.print_i32(bytes)
      c.println("")
      0
    }
    Err(e) => {
      c.println("stdin err")
      1
    }
  }
  return code
}
