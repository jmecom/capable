package safe
module wc_stdin
use sys::system
use sys::console
use sys::io
use sys::string
use sys::bytes
use sys::buffer
use sys::vec

pub fn main(sys: System) -> i32 {
  let c = system::console(sys)
  let code = match io::read_stdin_to_string() {
    Ok(s) => {
      let buf = string::bytes(s)
      let bytes = bytes::len(buf)
      let words_vec = string::split_whitespace(s)
      let words = vec::vec_string_len(words_vec)
      let alloc = buffer::alloc_default()
      vec::vec_string_free(alloc, words_vec)
      let i: i32 = 0
      let lines: i32 = 0
      while (i < bytes) {
        let b = bytes::at(buf, i)
        if (b == 10u8) {
          lines = lines + 1
        }
        i = i + 1
      }
      console::print_i32(c, lines)
      console::print(c, " ")
      console::print_i32(c, words)
      console::print(c, " ")
      console::print_i32(c, bytes)
      console::println(c, "")
      0
    }
    Err(e) => {
      console::println(c, "stdin err")
      1
    }
  }
  return code
}
