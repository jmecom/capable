package safe
module string_helpers
use sys::system

pub fn main(rc: RootCap) -> i32 {
  let c = rc.mint_console()
  let alloc = rc.mint_alloc_default()
  let s = "abc"
  let buf = s.bytes()
  let n = buf.len()
  let b = buf.at(0)
  let words = "a b  c".split_whitespace(alloc)
  let count = words.len()
  let trimmed = "  hi \n".trim(alloc)
  let trimmed_start = "  hi ".trim_start(alloc)
  let trimmed_end = "  hi ".trim_end(alloc)
  let trimmed_ascii = " \tHi\n".trim_ascii(alloc)
  let lower = "AbC".to_lower_ascii(alloc)
  let upper = "AbC".to_upper_ascii(alloc)
  let lines = "a\nb\n".split_lines(alloc)
  alloc.vec_string_free(words)
  alloc.vec_string_free(lines)
  c.assert(n == 3 && b == 'a' && count == 3)
  c.assert(trimmed.len() == 2)
  c.assert(trimmed.starts_with_byte('h'))
  c.assert(trimmed.ends_with_byte('i'))
  c.assert(trimmed_start.starts_with("hi"))
  c.assert(trimmed_end.ends_with("hi"))
  c.assert(trimmed_ascii.eq("Hi"))
  c.assert(lower.eq("abc"))
  c.assert(upper.eq("ABC"))
  c.assert("abc".starts_with_byte('a'))
  c.assert("abc".ends_with_byte('c'))
  c.assert("".is_empty())
  c.assert(!"a".is_empty())
  c.assert("abc".contains_byte('b'))
  c.assert(!"abc".contains_byte('x'))
  c.assert("abc".contains("b"))
  c.assert(!"abc".contains("x"))
  match ("abc".index_of_byte('c')) {
    Ok(i) => { c.assert(i == 2) }
    Err(_) => { c.assert(false) }
  }
  match ("abca".last_index_of_byte('a')) {
    Ok(i) => { c.assert(i == 3) }
    Err(_) => { c.assert(false) }
  }
  match ("abca".find_byte('a')) {
    Ok(i) => { c.assert(i == 0) }
    Err(_) => { c.assert(false) }
  }
  match ("abca".rfind_byte('a')) {
    Ok(i) => { c.assert(i == 3) }
    Err(_) => { c.assert(false) }
  }
  match ("ababa".index_of("ba")) {
    Ok(i) => { c.assert(i == 1) }
    Err(_) => { c.assert(false) }
  }
  match ("ababa".last_index_of("ba")) {
    Ok(i) => { c.assert(i == 3) }
    Err(_) => { c.assert(false) }
  }
  match ("abc".index_of("")) {
    Ok(i) => { c.assert(i == 0) }
    Err(_) => { c.assert(false) }
  }
  match ("abc".last_index_of("")) {
    Ok(i) => { c.assert(i == 3) }
    Err(_) => { c.assert(false) }
  }
  c.assert("abca".count_byte('a') == 2)
  c.assert("abc".is_ascii())
  c.assert("abc".byte_at_checked(10).is_err())
  match ("a,b,c".split_once(alloc, ',')) {
    Ok(parts) => {
      c.assert(parts.left.eq("a"))
      c.assert(parts.right.eq("b,c"))
    }
    Err(_) => { c.assert(false) }
  }
  let pieces = "a,b,c".split(alloc, ',')
  c.assert(pieces.len() == 3)
  match (pieces.join(",")) {
    Ok(joined) => { c.assert(joined.eq("a,b,c")) }
    Err(_) => { c.assert(false) }
  }
  c.println("string ok")
  return 0
}
