package safe
module string_helpers
use sys::system

pub fn main(rc: RootCap) -> i32 {
  let c = rc.mint_console()
  let s = "abc"
  let buf = s.bytes()
  let n = buf.len()
  let b = buf.at(0)
  let words = "a b  c".split_whitespace()
  let count = words.len()
  let trimmed = "  hi \n".trim()
  let trimmed_start = "  hi ".trim_start()
  let trimmed_end = "  hi ".trim_end()
  let lines = "a\nb\n".split_lines()
  let alloc = rc.mint_alloc_default()
  alloc.vec_string_free(words)
  alloc.vec_string_free(lines)
  c.assert(n == 3 && b == 97u8 && count == 3)
  c.assert(trimmed.len() == 2)
  c.assert(trimmed.starts_with_byte(104u8))
  c.assert(trimmed.ends_with_byte(105u8))
  c.assert(trimmed_start.starts_with("hi"))
  c.assert(trimmed_end.ends_with("hi"))
  c.assert("abc".starts_with_byte('a'))
  c.assert("abc".ends_with_byte('c'))
  c.assert("".is_empty())
  c.assert(!"a".is_empty())
  c.assert("abc".contains_byte(98u8))
  c.assert(!"abc".contains_byte(120u8))
  match ("abc".index_of_byte(99u8)) {
    Ok(i) => { c.assert(i == 2) }
    Err(_) => { c.assert(false) }
  }
  match ("abca".last_index_of_byte(97u8)) {
    Ok(i) => { c.assert(i == 3) }
    Err(_) => { c.assert(false) }
  }
  c.assert("abca".count_byte(97u8) == 2)
  c.assert("abc".is_ascii())
  c.assert("abc".byte_at_checked(10).is_err())
  c.println("string ok")
  return 0
}
