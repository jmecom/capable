package safe
module vec_helpers
use sys::system

pub fn main(rc: RootCap) -> i32 {
  let c = rc.mint_console()
  let alloc = rc.mint_alloc_default()
  let v = alloc.vec_u8_new()
  let extra = alloc.vec_u8_new()
  match v.push(65u8) {
    Ok(x) => {}
    Err(e) => { c.println("vec bad"); return 1 }
  }
  match v.push(66u8) {
    Ok(x) => {}
    Err(e) => { c.println("vec bad"); return 1 }
  }
  match extra.push(67u8) {
    Ok(x) => {}
    Err(e) => { c.println("vec bad"); return 1 }
  }
  match v.extend(extra) {
    Ok(x) => {}
    Err(e) => { c.println("vec bad"); return 1 }
  }
  let len = v.len()
  let b = v.get(1)
  let filtered = v.filter(66u8)
  let mapped = v.map_add(1u8)
  let slice = v.slice(1, 2)
  match (b) {
    Ok(x) => {
      c.assert(len == 3 && x == 66u8)
      c.assert(filtered.len() == 1)
      match (mapped.get(0)) {
        Ok(v0) => { c.assert(v0 == 66u8) }
        Err(e) => { c.println("vec bad"); return 1 }
      }
      match (slice) {
        Ok(s) => { c.assert(s.len() == 2) }
        Err(e) => { c.println("vec bad"); return 1 }
      }
      c.println("vec ok")
      alloc.vec_u8_free(filtered)
      alloc.vec_u8_free(mapped)
      alloc.vec_u8_free(v)
      alloc.vec_u8_free(extra)
      return 0
    }
    Err(e) => {}
  }
  c.println("vec bad")
  alloc.vec_u8_free(v)
  alloc.vec_u8_free(extra)
  return 1
}
