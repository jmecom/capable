package safe
module text_helpers_more
use sys::system
use sys::string

pub fn main(rc: RootCap) -> i32 {
  let c = rc.mint_console()
  let alloc = rc.mint_alloc_default()
  let text = alloc.text_new()
  match (text.push_str("hi")) {
    Ok(_) => { }
    Err(_) => { c.assert(false); return 1 }
  }
  match (text.push_byte('\n')) {
    Ok(_) => { }
    Err(_) => { c.assert(false); return 1 }
  }
  match (text.push_str("ok")) {
    Ok(_) => { }
    Err(_) => { c.assert(false); return 1 }
  }
  let v = alloc.vec_u8_new()
  match (v.push('!')) {
    Ok(_) => { }
    Err(_) => { c.assert(false); return 1 }
  }
  match (text.extend_vec(v)) {
    Ok(_) => { }
    Err(_) => { c.assert(false); return 1 }
  }
  match (text.to_string()) {
    Ok(s) => { c.assert(s.eq("hi\nok!")) }
    Err(_) => { c.assert(false); return 1 }
  }
  match (alloc.text_from("cap")) {
    Ok(t2) => {
      match (t2.to_string()) {
        Ok(s) => { c.assert(s.eq("cap")) }
        Err(_) => { c.assert(false); return 1 }
      }
      t2.free(alloc)
    }
    Err(_) => { c.assert(false); return 1 }
  }
  match ("owned".to_text(alloc)) {
    Ok(t3) => {
      match (t3.to_string()) {
        Ok(s) => { c.assert(s.eq("owned")) }
        Err(_) => { c.assert(false); return 1 }
      }
      t3.free(alloc)
    }
    Err(_) => { c.assert(false); return 1 }
  }
  alloc.vec_u8_free(v)
  text.free(alloc)
  c.println("text helpers ok")
  return 0
}
