package unsafe
module text_unsafe
use sys::system
use sys::string

pub fn main(rc: RootCap) -> i32 {
  let c = rc.mint_console()
  let alloc = rc.mint_alloc_default()
  let text = string::text_new(alloc)
  match (text.push_byte('a')) {
    Ok(_) => { }
    Err(_) => { c.assert(false); text.free(alloc); return 1 }
  }
  match (text.push_byte('b')) {
    Ok(_) => { }
    Err(_) => { c.assert(false); text.free(alloc); return 1 }
  }
  match (text.push_byte('c')) {
    Ok(_) => { }
    Err(_) => { c.assert(false); text.free(alloc); return 1 }
  }
  let len = text.len()
  c.assert(len == 3)
  if (len == 3) {
    c.println("text ok")
  } else {
    c.println("text bad")
  }
  let slice = text.as_slice()
  let s_len = slice.len()
  c.assert(s_len == 3)
  if (s_len == 3) {
    c.println("slice ok")
  } else {
    c.println("slice bad")
  }
  text.free(alloc)
  return 0
}
